[homing_override]
axes: z
set_position_z: 0
gcode:
    {% set max_x = printer["gcode_macro _GLOBALS"].build_plate_size[0]|float %}
    {% set max_y = printer["gcode_macro _GLOBALS"].build_plate_size[1]|float %}
    {% set safe_z = printer["gcode_macro _GLOBALS"].park_safe_z|float %}
    {% set speed = printer["gcode_macro _GLOBALS"].homing_travel_speed|float %}

    SAVE_GCODE_STATE NAME=state_homing
    G90
    G0 Z5 F{speed * 60}
    G28 X Y
    G0 X{max_x / 4} Y0 F{speed * 60}

    G28 Z
    G0 Z10 F600
    G0 X{max_x / 2} Y{max_y / 2} Z{safe_z} F{speed * 60}
    RESTORE_GCODE_STATE NAME=state_homing
